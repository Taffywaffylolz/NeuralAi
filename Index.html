import React, { useState, useRef, useEffect } from 'react';
import { Send, Sparkles, Image, Bot, User, Camera, Mic, Plus, Settings, Moon, Sun, LogIn, Shield, Lock, Eye, EyeOff } from 'lucide-react';

// âš ï¸ NEVER DO THIS IN PRODUCTION
const OPENAI_API_KEY = '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';

const App = () => {
  const [messages, setMessages] = useState([
    { id: 1, type: 'ai', content: "Hello! I'm Neural AI, your advanced AI assistant. I can help with questions, create stunning images, and more. How can I assist you today?" }
  ]);
  const [input, setInput] = useState('');
  const [isGenerating, setIsGenerating] = useState(false);
  const [darkMode, setDarkMode] = useState(true);
  const [activeTab, setActiveTab] = useState('chat');
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [showAuthModal, setShowAuthModal] = useState(false);
  const [authMode, setAuthMode] = useState('login');
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  // ðŸ”¥ REAL OpenAI API call (for demo only)
  const handleSend = async () => {
    if (!input.trim() || isGenerating) return;

    const userMessage = { id: Date.now(), type: 'user', content: input };
    setMessages(prev => [...prev, userMessage]);
    setInput('');
    setIsGenerating(true);

    // Check if it's an image request
    const isImageRequest = 
      input.toLowerCase().includes('image') ||
      input.toLowerCase().includes('picture') ||
      input.toLowerCase().includes('draw') ||
      input.toLowerCase().includes('generate') ||
      input.toLowerCase().includes('create an image');

    if (isImageRequest) {
      try {
        // Call DALLÂ·E via OpenAI
        const imagePrompt = input.replace(/(image|picture|draw|generate|create an image of|create)/gi, '').trim();
        
        const imageResponse = await fetch('https://api.openai.com/v1/images/generations', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({
            model: "dall-e-3",
            prompt: imagePrompt,
            n: 1,
            size: "1024x1024"
          })
        });

        const imageData = await imageResponse.json();
        if (imageData.error) {
          throw new Error(imageData.error.message || 'Image generation failed');
        }

        const imageUrl = imageData.data[0].url;
        setMessages(prev => [...prev, {
          id: Date.now(),
          type: 'ai',
          content: `Hereâ€™s your AI-generated masterpiece based on: "${imagePrompt}"`,
          image: imageUrl
        }]);
      } catch (err) {
        console.error('Image generation error:', err);
        setMessages(prev => [...prev, {
          id: Date.now(),
          type: 'ai',
          content: `âŒ Sorry, I couldnâ€™t generate that image. Error: ${err.message || 'Unknown error'}`
        }]);
      } finally {
        setIsGenerating(false);
      }
    } else {
      // Regular chat with GPT-4
      try {
        const chatMessages = messages
          .filter(msg => msg.type !== 'system') // ignore any system messages
          .map(msg => ({
            role: msg.type === 'user' ? 'user' : 'assistant',
            content: msg.content
          }));

        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({
            model: "gpt-4-turbo",
            messages: [
              {
                role: "system",
                content: "You are Neural AI â€” a brilliant, friendly, and ultra-modern AI assistant. Respond concisely but helpfully. Use emojis sparingly. If asked about images, suggest using the Image Generator tab."
              },
              ...chatMessages,
              { role: "user", content: input }
            ],
            temperature: 0.7,
            max_tokens: 500
          })
        });

        const data = await response.json();
        if (data.error) {
          throw new Error(data.error.message || 'API error');
        }

        const aiReply = data.choices[0].message.content;
        setMessages(prev => [...prev, {
          id: Date.now(),
          type: 'ai',
          content: aiReply
        }]);
      } catch (err) {
        console.error('Chat error:', err);
        setMessages(prev => [...prev, {
          id: Date.now(),
          type: 'ai',
          content: `âš ï¸ Neural AI had a hiccup: ${err.message || 'Connection failed. Try again.'}`
        }]);
      } finally {
        setIsGenerating(false);
      }
    }
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  const handleGoogleLogin = () => {
    setIsLoggedIn(true);
    setShowAuthModal(false);
    setMessages(prev => [...prev, { 
      id: Date.now(), 
      type: 'ai', 
      content: "âœ¨ Welcome back! You're now logged in to Neural AI. Ask me anything or create stunning AI art!" 
    }]);
  };

  const generateSampleImage = () => {
    const prompts = [
      "A futuristic neural network glowing in deep space, purple and electric blue, cyberpunk style",
      "An AI brain made of light particles, holographic interface, cinematic lighting",
      "A cosmic purple nebula forming the shape of a thinking brain, ultra-detailed, 8k",
      "Digital consciousness flowing through data rivers, neon violet, sci-fi concept art",
      "Elegant AI assistant as a hologram in a sleek lab, soft ambient light, photorealistic"
    ];
    const randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];
    setInput(randomPrompt);
  };

  if (!isLoggedIn) {
    return (
      <div className={`min-h-screen flex items-center justify-center transition-colors duration-300 ${darkMode ? 'bg-gray-900' : 'bg-gray-50'}`}>
        <div className={`w-full max-w-md p-8 rounded-2xl shadow-2xl ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
          <div className="text-center mb-8">
            <div className="flex justify-center mb-4">
              <div className="p-3 rounded-full bg-gradient-to-r from-purple-500 to-purple-700">
                <Sparkles className="h-8 w-8 text-white" />
              </div>
            </div>
            <h1 className="text-3xl font-bold bg-gradient-to-r from-purple-400 to-purple-600 bg-clip-text text-transparent mb-2">
              Neural AI
            </h1>
            <p className={`${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
              Powered by GPT-4 & DALLÂ·E 3
            </p>
          </div>

          <button
            onClick={handleGoogleLogin}
            className="w-full flex items-center justify-center space-x-3 py-3 px-4 border border-gray-300 rounded-xl hover:bg-gray-50 transition-colors mb-4"
          >
            <svg className="h-5 w-5" viewBox="0 0 24 24">
              <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
              <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
              <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.66-2.08z" fill="#FBBC05"/>
              <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
            </svg>
            <span className="font-medium">Continue with Google</span>
          </button>

          <div className="relative my-6">
            <div className="absolute inset-0 flex items-center">
              <div className={`w-full border-t ${darkMode ? 'border-gray-700' : 'border-gray-300'}`}></div>
            </div>
            <div className="relative flex justify-center text-sm">
              <span className={`px-2 ${darkMode ? 'bg-gray-800 text-gray-400' : 'bg-white text-gray-500'}`}>
                or continue with email
              </span>
            </div>
          </div>

          <div className="space-y-4">
            <div>
              <label htmlFor="email" className={`block text-sm font-medium mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                Email
              </label>
              <input
                id="email"
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className={`w-full px-4 py-3 rounded-xl border focus:ring-2 focus:ring-purple-500 focus:border-transparent ${
                  darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-gray-50 border-gray-300 text-gray-900'
                }`}
                placeholder="your@email.com"
              />
            </div>

            <div>
              <label htmlFor="password" className={`block text-sm font-medium mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                Password
              </label>
              <div className="relative">
                <input
                  id="password"
                  type={showPassword ? 'text' : 'password'}
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className={`w-full px-4 py-3 rounded-xl border focus:ring-2 focus:ring-purple-500 focus:border-transparent ${
                    darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-gray-50 border-gray-300 text-gray-900'
                  }`}
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute inset-y-0 right-0 pr-3 flex items-center"
                >
                  {showPassword ? <EyeOff className="h-5 w-5 text-gray-400" /> : <Eye className="h-5 w-5 text-gray-400" />}
                </button>
              </div>
            </div>

            <button
              onClick={() => {
                setIsLoggedIn(true);
                setMessages(prev => [...prev, { 
                  id: Date.now(), 
                  type: 'ai', 
                  content: "ðŸš€ Welcome to Neural AI! Powered by GPT-4 & DALLÂ·E 3. How can I assist you today?" 
                }]);
              }}
              className="w-full py-3 px-4 bg-gradient-to-r from-purple-600 to-purple-700 text-white font-medium rounded-xl hover:from-purple-700 hover:to-purple-800 transition-colors"
            >
              Sign In
            </button>
          </div>

          <div className="mt-6 text-center">
            <button
              onClick={() => setDarkMode(!darkMode)}
              className={`p-2 rounded-full ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}
            >
              {darkMode ? <Sun className="h-5 w-5" /> : <Moon className="h-5 w-5" />}
            </button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className={`min-h-screen transition-colors duration-300 ${darkMode ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'}`}>
      {/* Header */}
      <header className={`sticky top-0 z-10 backdrop-blur-md bg-opacity-80 ${darkMode ? 'bg-gray-800' : 'bg-white'} border-b ${darkMode ? 'border-gray-700' : 'border-gray-200'}`}>
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between items-center h-16">
            <div className="flex items-center space-x-3">
              <div className="p-2 rounded-lg bg-gradient-to-r from-purple-500 to-purple-700">
                <Sparkles className="h-6 w-6 text-white" />
              </div>
              <h1 className="text-xl font-bold bg-gradient-to-r from-purple-400 to-purple-600 bg-clip-text text-transparent">
                Neural AI
              </h1>
            </div>
            
            <div className="flex items-center space-x-4">
              <button 
                onClick={() => setDarkMode(!darkMode)}
                className={`p-2 rounded-full ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}
              >
                {darkMode ? <Sun className="h-5 w-5" /> : <Moon className="h-5 w-5" />}
              </button>
              <button 
                onClick={() => setIsLoggedIn(false)}
                className={`p-2 rounded-full ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}
              >
                <LogIn className="h-5 w-5" />
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Tabs */}
        <div className="flex border-b mb-6">
          <button
            onClick={() => setActiveTab('chat')}
            className={`px-4 py-2 font-medium text-sm rounded-t-lg transition-colors ${
              activeTab === 'chat' 
                ? (darkMode ? 'bg-gray-800 border-b-2 border-purple-500' : 'bg-white border-b-2 border-purple-500') 
                : (darkMode ? 'text-gray-400 hover:text-gray-300' : 'text-gray-500 hover:text-gray-700')
            }`}
          >
            <div className="flex items-center space-x-2">
              <Bot className="h-4 w-4" />
              <span>Chat</span>
            </div>
          </button>
          <button
            onClick={() => setActiveTab('images')}
            className={`px-4 py-2 font-medium text-sm rounded-t-lg transition-colors ${
              activeTab === 'images' 
                ? (darkMode ? 'bg-gray-800 border-b-2 border-purple-500' : 'bg-white border-b-2 border-purple-500') 
                : (darkMode ? 'text-gray-400 hover:text-gray-300' : 'text-gray-500 hover:text-gray-700')
            }`}
          >
            <div className="flex items-center space-x-2">
              <Image className="h-4 w-4" />
              <span>Image Generator</span>
            </div>
          </button>
        </div>

        {/* Chat Interface */}
        {activeTab === 'chat' && (
          <div className="flex flex-col h-[70vh]">
            <div className={`flex-1 overflow-y-auto rounded-xl p-4 mb-4 ${darkMode ? 'bg-gray-800' : 'bg-white'} shadow-lg`}>
              {messages.map((message) => (
                <div 
                  key={message.id} 
                  className={`flex mb-6 ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}
                >
                  <div className={`flex max-w-[80%] ${message.type === 'user' ? 'flex-row-reverse' : ''}`}>
                    <div className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${
                      message.type === 'user' 
                        ? (darkMode ? 'bg-purple-600' : 'bg-purple-500') 
                        : 'bg-gradient-to-r from-purple-500 to-purple-700'
                    }`}>
                      {message.type === 'user' ? <User className="h-4 w-4 text-white" /> : <Bot className="h-4 w-4 text-white" />}
                    </div>
                    <div className={`ml-3 ${message.type === 'user' ? 'mr-3' : ''}`}>
                      <div className={`px-4 py-3 rounded-2xl ${
                        message.type === 'user' 
                          ? (darkMode ? 'bg-purple-700' : 'bg-purple-500 text-white') 
                          : (darkMode ? 'bg-gray-700' : 'bg-gray-200')
                      }`}>
                        <p className="whitespace-pre-wrap">{message.content}</p>
                        {message.image && (
                          <div className="mt-3 rounded-xl overflow-hidden border border-purple-500/30 shadow-lg">
                            <img 
                              src={message.image} 
                              alt="AI generated" 
                              className="w-full h-auto"
                            />
                          </div>
                        )}
                      </div>
                      <div className={`text-xs mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                        {new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                      </div>
                    </div>
                  </div>
                </div>
              ))}
              {isGenerating && (
                <div className="flex justify-start mb-6">
                  <div className="flex max-w-[80%]">
                    <div className="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center bg-gradient-to-r from-purple-500 to-purple-700">
                      <Bot className="h-4 w-4 text-white" />
                    </div>
                    <div className="ml-3">
                      <div className={`px-4 py-3 rounded-2xl ${darkMode ? 'bg-gray-700' : 'bg-gray-200'}`}>
                        <div className="flex space-x-2">
                          <div className={`w-2 h-2 rounded-full ${darkMode ? 'bg-purple-400' : 'bg-purple-500'} animate-bounce`} style={{ animationDelay: '0ms' }}></div>
                          <div className={`w-2 h-2 rounded-full ${darkMode ? 'bg-purple-400' : 'bg-purple-500'} animate-bounce`} style={{ animationDelay: '150ms' }}></div>
                          <div className={`w-2 h-2 rounded-full ${darkMode ? 'bg-purple-400' : 'bg-purple-500'} animate-bounce`} style={{ animationDelay: '300ms' }}></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              )}
              <div ref={messagesEndRef} />
            </div>

            <div className={`flex items-end rounded-xl p-4 ${darkMode ? 'bg-gray-800' : 'bg-white'} shadow-lg`}>
              <div className="flex-1 relative">
                <textarea
                  value={input}
                  onChange={(e) => setInput(e.target.value)}
                  onKeyDown={handleKeyPress}
                  placeholder="Message Neural AI (try: 'draw a cyberpunk cat' or 'explain quantum computing')..."
                  className={`w-full py-3 px-4 pr-12 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-purple-500 ${
                    darkMode ? 'bg-gray-700 text-white placeholder-gray-400' : 'bg-gray-100 text-gray-900 placeholder-gray-500'
                  }`}
                  rows="1"
                  style={{ minHeight: '44px', maxHeight: '120px' }}
                />
                <div className="absolute right-3 bottom-3 flex space-x-2">
                  <button className={`p-1.5 rounded-full ${darkMode ? 'hover:bg-gray-600' : 'hover:bg-gray-200'}`}>
                    <Plus className="h-4 w-4" />
                  </button>
                  <button className={`p-1.5 rounded-full ${darkMode ? 'hover:bg-gray-600' : 'hover:bg-gray-200'}`}>
                    <Mic className="h-4 w-4" />
                  </button>
                </div>
              </div>
              <button
                onClick={handleSend}
                disabled={!input.trim() || isGenerating}
                className={`ml-3 p-3 rounded-full ${
                  input.trim() && !isGenerating 
                    ? 'bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800' 
                    : (darkMode ? 'bg-gray-700' : 'bg-gray-300')
                } transition-colors text-white`}
              >
                <Send className="h-5 w-5" />
              </button>
            </div>
          </div>
        )}

        {/* Image Generator */}
        {activeTab === 'images' && (
          <div className="flex flex-col h-[70vh]">
            <div className={`flex-1 overflow-y-auto rounded-xl p-6 mb-6 ${darkMode ? 'bg-gray-800' : 'bg-white'} shadow-lg`}>
              <div className="text-center mb-6">
                <h2 className="text-xl font-bold mb-2">AI Image Gallery</h2>
                <p className={darkMode ? 'text-gray-400' : 'text-gray-600'}>
                  Generate unique images with DALLÂ·E 3. Describe anything!
                </p>
              </div>
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                {[1, 2, 3, 4, 5, 6].map((item) => (
                  <div 
                    key={item} 
                    className={`rounded-xl overflow-hidden border transition-transform hover:scale-[1.02] ${
                      darkMode ? 'border-gray-700 hover:shadow-purple-900/30' : 'border-gray-200 hover:shadow-purple-200'
                    } hover:shadow-xl`}
                  >
                    <div className="bg-gradient-to-br from-purple-900/10 to-indigo-800/10 border-2 border-dashed border-purple-500/30 rounded-xl w-full h-48 flex items-center justify-center">
                      <Sparkles className="h-8 w-8 text-purple-400" />
                    </div>
                    <div className="p-4">
                      <h3 className="font-medium mb-1 text-purple-400">Concept #{item}</h3>
                      <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                        {item % 2 === 0 
                          ? "Futuristic AI city at night" 
                          : "Neural patterns in cosmic void"}
                      </p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
            
            <div className={`flex flex-col sm:flex-row gap-4 rounded-xl p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'} shadow-lg`}>
              <div className="flex-1">
                <input
                  type="text"
                  value={input}
                  onChange={(e) => setInput(e.target.value)}
                  placeholder="Describe your dream image (e.g., 'a cat made of stardust, digital art')..."
                  className={`w-full py-3 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 ${
                    darkMode ? 'bg-gray-700 text-white placeholder-gray-400' : 'bg-gray-100 text-gray-900 placeholder-gray-500'
                  }`}
                />
              </div>
              <div className="flex space-x-3">
                <button
                  onClick={generateSampleImage}
                  className={`px-4 py-3 rounded-xl flex items-center space-x-2 ${
                    darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'
                  } transition-colors`}
                >
                  <Sparkles className="h-4 w-4 text-purple-500" />
                  <span>Idea</span>
                </button>
                <button
                  onClick={handleSend}
                  disabled={!input.trim() || isGenerating}
                  className={`px-6 py-3 rounded-xl flex items-center space-x-2 ${
                    input.trim() && !isGenerating 
                      ? 'bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800' 
                      : (darkMode ? 'bg-gray-700' : 'bg-gray-300')
                  } transition-colors text-white`}
                >
                  <Camera className="h-4 w-4" />
                  <span>Generate</span>
                </button>
              </div>
            </div>
          </div>
        )}
      </main>

      {/* Security Notice */}
      <div className={`fixed bottom-4 left-4 max-w-xs p-3 rounded-lg flex items-center space-x-2 ${
        darkMode ? 'bg-red-900/80 text-red-100' : 'bg-red-100 text-red-800'
      }`}>
        <Shield className="h-4 w-4 flex-shrink-0" />
        <p className="text-xs">
          <strong>DEMO ONLY:</strong> OpenAI key exposed! Revoke immediately after testing.
        </p>
      </div>
    </div>
  );
};

export default App;
